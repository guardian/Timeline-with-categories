<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Timeline | The Guardian</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="css/timeline.css" />
		<script src="js/modernizr.custom.js"></script>
		<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>

	</head>
	<body>
		
		<div id="manus" class="gia-container">
		
			<div id="manusLeadImage"><span id="manusImageText"><i>A customs vessel hails an asylum seeker boat</i></span></div>
			<nav id="nav" class="navbar navbar-default" role="navigation">
				<div class="navbar-header">
					 <ul class="nav navbar-nav">
					 <span class="key-header">Incident category</span>
					 <li class="key distress_call"><span class="catMarker"></span><span class="catText">Distress call</span> </li>
					 <li class="key boat_interception"><span class="catMarker"></span><span class="catText">Boat intercepted</span></li>
					 <li class="key turnback"><span class="catMarker"></span><span class="catText">Turnback</span></li>
					 <li class="key boat_arrival"><span class="catMarker"></span><span class="catText">Boat arrival</span></li>	
					 <li class="key">|</li>
				     <li class="dropdown">
				        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Filter <b class="caret"></b></a>
				        <ul class="dropdown-menu">
				          <li><a href="#" id="turnbackFilter">Turnbacks</a></li>
				          <li><a href="#" id="distressFilter">Distress calls</a></li>
				          <li><a href="#" id="arrivalFilter">Boat arrivals</a></li>
				          <li><a href="#" id="interceptionFilter">Boat interceptions</a></li>
				          <li class="divider"></li>
				          <li><a href="#" id="showallFilter">Show all</a></li>
				        </ul>
				      </li>
				      <li class="key">|</li>
				      <li><a href="#" id="gotoTop">Go to top</a></li>
				      <li class="key">|</li>
				      <li><a href="#" id="expandAll">Expand all</a></li>
				     

				    </ul> 
				</div>
			
	

			</nav>		
			<div class="gia-main">
	 
				<ul class="cbp_tmtimeline" id="timeline">

				</ul>
			</div>
		</div>

		<script type="text/javascript">

		var gia=(function(gia,$){

			

			gia.init = function(){

				var expanded = "no";

				$.ajax({
				    url: 'data/osb-incidents.json',
				    dataType: 'jsonp',
				    jsonp: false,
				    jsonpCallback: 'content'
					}).done(function (data) {

				console.log(data);

				for (var i = 0; i < data.length; i++) {

					var link = String(location).split('#')[0] + "#manus" + (i + 1);
					var tweetText = data[i]['title'] + " " + link + " via @GuardianAus";
					var tweet = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(tweetText);
					var fbText = data[i]['title'] + " - Operation Sovereign borders incident number " + (i + 1);
					var facebook = 'http://www.facebook.com/sharer.php?s=100&p[title]=Operation%20Sovereign%20Borders%20incidents&p[summary]=' + fbText + '&p[url]=' + link + '&p[images][0]=http://interactive.guim.co.uk/australia/2014/june/osb-timeline/img/customs.jpg';

					$('#timeline').append('<li class="incident ' + data[i]['incident-category'] + '" id="manus' + (i + 1) + '"><time class="cbp_tmtime" datetime="' + data[i]['date'] + '"><span>' + data[i]['date'] + '</span><span>' + '</time>' + '<div class="cbp_tmicon cbp_tmicon-phone"></div><div class="cbp_tmlabel"><span class="manusupdate">' + data[i]['updated'] + '</span><h2 data-incident="manus' + (i + 1) + '">' + data[i]['title'] + '</h2><div class="details"><p>' + data[i]['text'] + '</p><p>' + '<span class="update">source: ' + '<a href="' + data[i]['link'] + '" target="_blank">' + data[i]['source'] + '</a></span></p><span class="manusShareLinks">Share this incident: <a href="' + link + '" target="_blank">link</a> | <a href="' + tweet + '" target="_blank">twitter</a> | <a href="' + facebook + '" target="_blank">facebook</a></span></div></div></li>')

				}

					$(".incident h2").click(function() {

					var currInc = $(this).attr('data-incident');
			
					if ($("#" + currInc + " .details").is(':visible')) {
						$("#" + currInc + " .details").slideUp();
						$("#" + currInc + " h2").css("background-image", "url(http://interactive.guim.co.uk/australia/2013/december/manusincidents/img/down.png)"); 
					}

					else if ($("#" + currInc + " .details").is(':hidden')) {
						$("#" + currInc + " .details").slideDown();
						$("#" + currInc + " h2").css("background-image", "url(http://interactive.guim.co.uk/australia/2013/december/manusincidents/img/up.png)"); 
					}
					

			    });

				function manusParseURL() {

				var incLoc = location.hash;

				console.log(incLoc); 	

				if (incLoc.substring(0,6) === '#manus') {

					$('html, body').animate({
				    scrollTop: ($(incLoc).offset().top - 150)
					},1000);	

					$(incLoc + " .details").slideDown();
					$(incLoc + " h2").css("background-image", "url(http://interactive.guim.co.uk/australia/2013/december/manusincidents/img/up.png)"); 

 				}

 		
				};

				manusParseURL();

				});

				$('#nav').affix({
			        offset: { top: $('#nav').offset().top }
			    });
	

				$("#turnbackFilter").click(function() {
					$("#timeline .turnback").fadeIn();
		  			$("#timeline .boat_arrival").fadeOut();
		  			$("#timeline .boat_interception").fadeOut();
		  			$("#timeline .distress_call").fadeOut();	
				});

				$("#arrivalFilter").click(function() {
					$("#timeline .turnback").fadeOut();
		  			$("#timeline .boat_arrival").fadeIn();
		  			$("#timeline .boat_interception").fadeOut();
		  			$("#timeline .distress_call").fadeOut();	
				});

				$("#distressFilter").click(function() {
					$("#timeline .turnback").fadeOut();
		  			$("#timeline .boat_arrival").fadeOut();
		  			$("#timeline .boat_interception").fadeOut();
		  			$("#timeline .distress_call").fadeIn();
				});

				$("#interceptionFilter").click(function() {
					$("#timeline .turnback").fadeOut();
		  			$("#timeline .boat_arrival").fadeOut();
		  			$("#timeline .boat_interception").fadeIn();
		  			$("#timeline .distress_call").fadeOut();
				});


				setTimeout(function(){
						$(".abbrevPopover").popover({placement:'top', trigger:'hover'});	
					}, 1000);	

				console.log($('.abbrevPopover'));

				$("#showallFilter").click(function() {
					resetFilter();
				});


				$("#expandAll").click(function() {

					if (expanded == "no") {
					$(".details").slideDown();
					$("#expandAll").html("Minimise all");
					expanded = "yes";
					$("#manus h2").css("background-image", "url(http://interactive.guim.co.uk/australia/2013/december/manusincidents/img/up.png)"); 

					}

					else if (expanded == "yes") {
						$(".details").slideUp();
						$("#expandAll").html("Expand all");
						expanded = "no";
						$("#manus h2").css("background-image", "url(http://interactive.guim.co.uk/australia/2013/december/manusincidents/img/down.png)"); 

					}

				});

				$("#gotoTop").click(function() {

				$('html, body').animate({
				    scrollTop: ($('#manus').offset().top)
				},1000);
				});

				function resetFilter() {

					$("#timeline .turnback").fadeIn();
		  			$("#timeline .boat_arrival").fadeIn();
		  			$("#timeline .boat_interception").fadeIn();
		  			$("#timeline .distress_call").fadeIn();

				}

			


				}

			return gia;

		}(gia || {},jQuery));

		gia.init();


	</script>	

	</body>

</html>
