<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Timeline | The Guardian</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
		<link rel="stylesheet" type="text/css" href="css/timeline.css" />
		<script src="js/modernizr.custom.js"></script>
		<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		

		<!--[if lt IE 9]>
		<script src="http://css3-mediaqueries-js.googlecode.com/files/css3-mediaqueries.js"></script>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

	</head>
	<body>
		
		<div id="timeline" class="timeline-container">
			
		<div id="nav" class="navbar" >	
			<div class="nav-categories">
					<ul id="category-menu" class="clearfix">
						<li class="current">Categories</li>
				        <li class="category"><a href="#" id="majoreventFilter" data-cat="major-event" class="major-event">Major event</a></li>
				        <li class="category"><a href="#" id="governmentannouncementFilter" data-cat="government-announcement" class="government-announcement">Government</a></li>
				        <li class="category"><a href="#" id="oppositionannouncementFilter" data-cat="opposition-or-other" class="opposition-or-other">Opposition/other</a></li>
				        <li class="category"><a href="#" id="legislationFilter" data-cat="legislation" class="legislation">Legislation</a></li>
				        <li class="category"><a href="#" id="mediaFilter" data-cat="media" class="media">Media</a></li>
				        <li class="category"><a href="#" id="showallFilter" data-cat="showall">Show all</a></li>
				    </ul>

			</div>
			<div id="nav-buttons">
				<span class="glyphicon glyphicon-plus-sign" id="expandAll" title="Expand or minimise all"></span>
			</div>	 
			<div class="clearfix"></div>
		</div>	

			<div class="timeline-main">
	 
				<ul class="cbp_tmtimeline" id="timeline-list">

				</ul>
			</div>
		</div>
		<script src="http://interactive.guim.co.uk/libs/iframe-messenger/iframeMessenger.js" type="text/javascript"></script>
		<script type="text/javascript">
		iframeMessenger.enableAutoResize();

		var gia=(function(gia,$){

		
			gia.init = function(){

				var expanded = "no";

				$.ajax({
				    url: 'data/natsec.json',
				    dataType: 'jsonp',
				    jsonp: false,
				    jsonpCallback: 'content'
					}).done(function (data) {

				console.log(data);

				for (var i = 0; i < data.length; i++) {

					$('#timeline-list').append(
						'<li class="incident ' 
						+ data[i]['incident-category'] 
						+ '" id="timeline-entry' 
						+ (i + 1) 
						+ '"><time class="cbp_tmtime" datetime="' 
						+ data[i]['date'] 
						+ '"><span>' 
						+ data[i]['date'] 
						+ '</span><span>' 
						+ '</time>' 
						+ '<div class="cbp_tmicon cbp_tmicon-phone"></div><div class="cbp_tmlabel"><span class="manusupdate">' 
						+ data[i]['updated'] 
						+ '</span><h2 data-incident="timeline-entry' 
						+ (i + 1) + '">' 
						+ data[i]['title'] 
						+ '</h2><div class="details"><p>' 
						+ data[i]['text'] 
						+ '</p><p>'
						+ '<span class="update">'
						+ data[i]['source-title']
						+ '<a href="' 
						+ data[i]['link'] 
						+ '" target="_blank">' 
						+ data[i]['source'] 
						+ '</a></span><br>'
						+ '<span class="update">'
						+ data[i]['analysis-title']
						+ '<a href="' 
						+ data[i]['analysis-link'] 
						+ '" target="_blank">' 
						+ data[i]['analysis-text'] 
						+ '</a></span><br>'
						+ '</p></div></div></li>')

				}

					$(".incident h2").click(function() {

					var currInc = $(this).attr('data-incident');
			
					if ($("#" + currInc + " .details").is(':visible')) {
						$("#" + currInc + " .details").slideUp();
						$("#" + currInc + " h2").css("background-image", "url(img/down.png)"); 
					}

					else if ($("#" + currInc + " .details").is(':hidden')) {
						$("#" + currInc + " .details").slideDown();
						$("#" + currInc + " h2").css("background-image", "url(img/up.png)"); 
					}
					

			    });

				});

				var catList = ['media','government-announcement','opposition-or-other','major-event','legislation']

				$(".category a").click(function() {

					var catID = $(this).data('cat');
					console.log(catID);
					
					if (catID != 'showall') {

						catList.forEach(function(cat) {
						if (cat != catID) {

							$("#timeline-list ." + cat).fadeOut();
						}
						});

						$("#timeline-list ." + catID).fadeIn();
					} 

					else if (catID === 'showall') {

						catList.forEach(function(cat) {
							$("#timeline-list ." + cat).fadeIn();
						});


					}
									

				});
				


		

				$("#expandAll").click(function() {

					if (expanded == "no") {
					$(".details").slideDown();
					$("#expandAll").removeClass("glyphicon-plus-sign");
					$("#expandAll").addClass("glyphicon-minus-sign");

					expanded = "yes";
					$("#timeline-list h2").css("background-image", "url(img/up.png)"); 

					}

					else if (expanded == "yes") {
						$(".details").slideUp();
						$("#expandAll").addClass("glyphicon-plus-sign");
						$("#expandAll").removeClass("glyphicon-minus-sign");
						expanded = "no";
						$("#timeline-list h2").css("background-image", "url(img/down.png)"); 

					}

				});

				if (window!=window.top) { 
				
					setInterval(function(){

						iframeMessenger.getPositionInformation(function(data) {
					        console.log("pageYOffSet", data['pageYOffset'], "iframeTop", data['iframeTop']);
					        if (data['iframeTop'] < 0) {

					        	$('#nav').css('top', -1*data['iframeTop'] + 'px');
					        }

					        if (data['iframeTop'] > 0) {
					        	$('#nav').css('top', '0px');

					        }
					    });

					}, 200);

				}

			
				$(".current").click(function(){

					getW = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);

					if ($(".category").is(':visible')) {
						$(".category").hide();
					}

					else if ($(".category").is(':hidden')) {
						$(".category").show();
						if (getW > 601) {

						$(".nav-categories li").css("display", "inline-block");
						
						}
					}
					
					
				});


				

				if( !/iPhone|iPad|iPod/i.test(navigator.userAgent) ) {

				$(window).resize(function() {

				getW = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);

				if (getW > 601) {

					if ($(".category").is(':hidden')) {
						$(".category").show();
						$(".nav-categories li").css("display", "inline-block");
					}
				 
				}


				if (getW < 600) {

					$(".nav-categories li").css("display", "block");

					if ($(".category").is(':visible')) {
						$(".category").hide();
						
					}

				}

				});


				}

	

				}

			return gia;

		}(gia || {},jQuery));

		gia.init();


	</script>	

	</body>

</html>
